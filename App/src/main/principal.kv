#: import Factory kivy.factory.Factory
<RoundedButton@Button>
    font_size:25
    background_color: (0,0,0,0)
    background_normal: ''
    Image:
        source: "Imagens\keyboard-backspace.png"
        center_x: self.parent.center_x
        center_y: self.parent.center_y 
        allow_stretch: True

<LoginButton@Button>
    font_size:18
    background_color: (0,0,0,0)
    background_normal: ''
    canvas.before:  
        Color:
            rgba: (48/255,84/255,150/255,1)
        RoundedRectangle:
            size: self.width, 60
            pos: self.pos
            radius: [50]
<LoginPopup@Popup>
    auto_dismiss: False
    size_hint: 0.6, 0.7
    pos_hint: {'x': 0.2,'center_y': 0.4}
    title: ""
    id: login_pop
    BoxLayout:
        orientation: "vertical"
        size: root.width, root.height
        Label:
            text: "Usuario"
            font_size:20
        TextInput:
            id: usuario
        Label:
            text:"Senha"
            font_size:20
        TextInput:
            id: senha
        LoginButton:
            text: "Entrar"
            #on_press: print(usuario.text+senha.text)
            on_press: app.root.autenticarLogin(login_pop,usuario.text,senha.text)
           #on_release: app.root.current = "telag"
        LoginButton:
            text: "Cancelar"
            on_release: root.dismiss()
# <GerarValor@popup>
#     auto_dismiss: False
#     size_hint: 0.6, 0.7
#     pos_hint: {'x': 0.2,'center_y': 0.4}
#     title: "Ticket"
#     id: valor_pop
#         GridLayout:
#             cols: 2
#             size: root.width, root.height
#             Label:
#                 text: "Número da Vaga:"
#                 font_size:20
#             Label:
#                 text: ""
#                 font_size:20
#             Label:
#                 text:"Tipo de Cliente:"
#                 font_size:20
#             Label:
#                 text: ""
#                 font_size:20
#             Label:
#                 text: "Hora de Entrada:"
#                 font_size:20
#             Label:
#                 text: ""
#                 font_size:20
#             Label:
#                 text:"Hora de Saida:"
#                 font_size:20
#             Label:
#                 text: ""
#                 font_size:20
#             Label:
#                 text:"Valor a ser Pago:"
#                 font_size:20
#             Label:
#                 text: ""
#                 font_size:20
#         Button:
#             text: "OK"
#             on_release: root.dismiss()



<PopupSucesso@Popup>
    auto_dismiss: True
    size_hint: 0.6, 0.2
    pos_hint: {"x": 0.2,"center": 0.5}
    title: "Adicionado com sucesso!"
    Button:
        text: "Confirmar"
        font_size: 15
        on_release: root.dismiss()
<PopupSucesso2@Popup>
    auto_dismiss: True
    size_hint: 0.6, 0.2
    pos_hint: {"x": 0.2,"center": 0.5}
    title: "Removido com sucesso!"
    Button:
        text: "Confirmar"
        font_size: 15
        on_release: root.dismiss()
<PopupSucesso3@Popup>
    auto_dismiss: True
    size_hint: 0.6, 0.2
    pos_hint: {"x": 0.2,"center": 0.5}
    title: "Atualizado com sucesso!"
    Button:
        text: "Confirmar"
        font_size: 15
        on_release: root.dismiss()

<PopupBoleto>:
    title: "Boleto"
    size_hint: None, None
    size: 300, 500
    auto_dismiss: False

    BoxLayout:
        orientation: "vertical"
        BoxLayout:
            orientation:'horizontal'
            Label:
                text: "Número da Vaga"
                color:
            Label:
                text: str(root.nmr_vg)
                color: 
        BoxLayout:
            orientation:'horizontal'
            Label:
                text: "Entrada da Vaga"
                color:
            Label:
                text: str(root.entrada)
                color:
        BoxLayout:
            orientation:'horizontal'
            Label:
                text: "Saida da Vaga"
                color:
            Label:
                text: str(root.saida)
                color:  
        BoxLayout:
            orientation:'horizontal'
            Label:
                text: "Total Boleto"
                color:
            Label:
                text: str(root.total)
                color:   
        BoxLayout:
            orientation:'horizontal'
            Button:
                size_hint: 1, 1
                text: "Imprimir"
                on_release:
                #     root.nome = nome.text
                #     root.telefone = telefone.text
                #     root.cpf = cpf.text
                #     root.email = email.text
                #     root.save(app.root.ids.telaclilistar)
                    root.dismiss()
            Button:
                size_hint: 1, 1
                text: "Sair"
                on_release: root.dismiss()



<TextInputPopup>:
    title: "Editar"
    size_hint: None, None
    size: 300, 500
    auto_dismiss: False

    BoxLayout:
        orientation: "vertical"
        BoxLayout:
            orientation:'horizontal'
            Label:
                text: "ID"
                color:
            Label:
                text: str(root.id)
                color:
        Label:
            text: "Nome"
            color:
        TextInput:
            id: nome
            text: root.nome
        Label:
            text: "Telefone"
            color:
        TextInput:
            id: telefone
            text: root.telefone
        Label:
            text: "CPF"
            color:
        TextInput:
            id: cpf
            text: root.cpf
        Label:
            text: "Email"
            color:
        TextInput:
            id: email
            text: root.email        
        BoxLayout:
            orientation:'horizontal'
            Button:
                size_hint: 1, 1
                text: "Salvar"
                on_release:
                    root.nome = nome.text
                    root.telefone = telefone.text
                    root.cpf = cpf.text
                    root.email = email.text
                    root.save(app.root.ids.telaclilistar)
                    root.dismiss()
            Button:
                size_hint: 1, 1
                text: "Cancelar"
                on_release: root.dismiss()


<Gerenciador>
    TelaPrincipal:
        name: "telaPrincipal"
    TelaCli:
        name: "telacli"
    TelaCliCadastro:
        name: "telaclicadas"
    TelaCliListar:
        id: telaclilistar
        name: "telaclilista"    
    TelaFunc:
        name: "telafunc"
    TelaFuncCadastro:
        name: "telafuncadas"
    TelaFuncListar:
        name: "telafunclista"
    TelaGerenciamento:
        name: "telag"
    TelaPagamento:
        name: "telpag"
<TelaPrincipal>:
    canvas.before:
        Color:
            rgba: (1,1,1,1)
        Rectangle:
            pos:self.pos
            size: self.size
    BoxLayout:
        orientation: "vertical"
        ActionBar:
            padding:16
            ActionView:
                pos_hint: {"center_y": 1.0}
                ActionPrevious:
                    title: "Inicio"
                    on_release:app.root.current = telaprincipal
                ActionButton:
                    text: "Login"
                    on_release:Factory.LoginPopup().open()
                ActionSeparator:
                ActionButton:
                    text: "Sair"
                    on_release:app.stop()
        Image:
            source: "LogoPNG.png"

            
<TelaGerenciamento>:
    canvas.before:
        Color:
            rgba: (1,1,1,1)
        Rectangle:
            pos:self.pos
            size: self.size
    GridLayout:
        rows: 2
        BoxLayout:
            orientation: "vertical"
            BoxLayout:
                padding:50
                spacing: 20
                orientation: "horizontal"
                Button:
                    text: "Funcionario"
                    background_color: 0,0,0,0
                    on_press: app.root.current = "telafunc"
                    Image:
                        source: "Imagens/account.png"
                        center_x: self.parent.center_x
                        center_y: self.parent.center_y
                        allow_stretch: True 
                Button:
                    text: "Cliente"
                    background_color: 0,0,0,0
                    on_press: app.root.current = "telacli"
                    Image:
                        source: "Imagens/cliente_cartao.png"
                        center_x: self.parent.center_x
                        center_y: self.parent.center_y
                        allow_stretch: True
                Button:
                    text: "Pagamento"
                    background_color: 0,0,0,0
                    on_press: app.root.current = "telpag"
                    Image:
                        source: "Imagens/pagamento.png"
                        center_x: self.parent.center_x
                        center_y: self.parent.center_y
                        allow_stretch: True
        BoxLayout:
            orientation:'vertical'
            BoxLayout:
                padding:50
                spacing: 20
                orientation: "horizontal"
                Label:
                    text:'Funcionários'
                    color: 'black'
                    font_size: 25
                Label:
                    text:'Clientes'
                    color: 'black'
                    font_size: 25                    
                Label:
                    text:'Pagamento'
                    color: 'black'
                    font_size: 25

<TelaFunc>:
    canvas.before:
        Color:
            rgba: (1,1,1,1)
        Rectangle:
            pos:self.pos
            size: self.size
    GridLayout:
        rows: 2
        GridLayout:
            cols: 2
            padding: 0
            spacing: 0
            Button:
                text: 'Cadastro'
                background_color: 0,0,0,0
                on_press: app.root.current = "telafuncadas"
                Image:
                    source: "Imagens/adicionar.png"
                    center_x: self.parent.center_x
                    center_y: self.parent.center_y
                    allow_stretch: True
            Button:
                text: 'Listar'
                background_color: 0,0,0,0
                on_press: app.root.current = "telafunclista"
                Image:
                    source: "Imagens/list-status.png"
                    center_x: self.parent.center_x
                    center_y: self.parent.center_y 
                    allow_stretch: True        
        GridLayout:
            cols: 3
            padding: 50
            spacing: 10
            Button:
                background_color: (0,0,0,0)
                background_normal: ''
            RoundedButton:
                text: 'Voltar'
                size_hint: 0.3,0.05
                background_color: 0,0,0,0
                on_press: app.root.current = "telag"  
            Button:
                background_color: (0,0,0,0)
                background_normal: ''      



<TelaFuncCadastro>:
    nome_inserir: nome_inserir
    telefone_inserir: telefone_inserir
    email_inserir: email_inserir
    funcao_inserir: funcao_inserir
    turno_inserir: turno_inserir
    acesso_inserir:acesso_inserir
    canvas.before:
        Color:
            rgba: (1,1,1,1)
        Rectangle:
            pos:self.pos
            size: self.size
    
    GridLayout:
        cols: 2
        size: root.width,root.height
        padding: 30
        spacing: 20
        Label:
            text:'Nome do Funcionario'
            color: "black"
        TextInput:
            id: nome_inserir
            multiline: False
        Label:
            text:'Telefone do Funcionario'
            color: "black"
        TextInput:
            id: telefone_inserir
            multiline: False
        Label:
            text:'E-mail do Funcionario'
            color: "black"
        TextInput:
            id: email_inserir
            multiline: False
        Label:
            text:'Função do Funcionario'
            color: "black"
        TextInput:
            id: funcao_inserir
            multiline: False
        Label:
            text:'Turno do Funcionario'
            color: "black"
        TextInput:
            id: turno_inserir
            multiline: False
        Label:
            text: 'Acesso ao Sistema'
            color: "black"    
        CheckBox:
            id: acesso_inserir

        RoundedButton:
            text: "Cancelar"
            on_press: app.root.current="telafunc"    
                
        Button:
            text: "Confirmar"
            background_color: 0,0,0,0
            on_press: root.enviarBD()
            on_release: Factory.PopupSucesso().open()
            Image:
                source: "Imagens/check.png"
                center_x: self.parent.center_x
                center_y: self.parent.center_y
                allow_stretch: True
        



<TelaFuncListar>:
    canvas.before:
        Color:
            rgba: (1,1,1,1)
        Rectangle:
            pos:self.pos
            size: self.size
    BoxLayout:
        orientation:'horizontal'
        BoxLayout:
            orientation:'vertical'
            GridLayout:
                size_hint: 1, None
                size_hint_y: None
                height: 25
                cols:8
                Label:
                    text: "ID"
                    color: "black"
                Label:
                    text: "Nome"
                    color: 'black'
                Label:
                    text: "Telefone"
                    color: 'black'
                Label:
                    text: "Função"
                    color: 'black'
                Label:
                    text: "Turno"
                    color: 'black'
                Label:
                    text: "Email" 
                    color: 'black'   
                Label:
                    text: "Acesso" 
                    color: 'black'   
            BoxLayout:
                orientation: 'horizontal'
                RecycleView:
                    id: lt_funcionario
                    viewclass: 'SelectableButton'
                    data: [{'text': str(x)} for x in root.data_items]
                    SelectableRecycleGridLayout:
                        cols:8
                        default_size: None, dp(26)
                        default_size_hint: 1, None
                        size_hint_y: None
                        height: self.minimum_height
                        multiselect: True
                        touch_multiselect: True
        BoxLayout:
            orientation:'vertical'
            GridLayout:
                size_hint: 1, None
                size_hint_y: None
                height: 25
                cols: 2
                Label:
                    text: "Editar"
                    color: 'black'  
                    size_hint: .5, 1
                Label:
                    text: "Deletar"
                    color: 'black'  
                    size_hint: .5, 1
            RecycleView:
                id: bt_act_funcionario
                viewclass: 'ButtonActionsFunc'
                data: [{'id': x } for x in range(int(len(root.data_items)/6))]
                SelectableRecycleGridLayout:
                    cols: 1
                    default_size: None, dp(26)
                    default_size_hint: 1, None
                    size_hint_y: None
                    height: self.minimum_height
                    multiselect: True
                    touch_multiselect: True
    RoundedButton:
        text: "Voltar"
        size_hint: 0.3, 0.3
        pos_hint: {"center_x":0.5}
        on_press: app.root.current="telafunc"

<ButtonActionsFunc>:
    # size: '100dp','100dp'
    size: 200,100
    size_hint: None, None
    Button:
        size_hint: .2, 1
        text: ""
        color:
        on_press: 
            # print(f'dados: ${app.root.data_items[root.id*6:(root.id*6)+6]} id:${root.id}')
            root.edit(root.id*6)
        Image:
            source: "Imagens/editar.png"
            center_x: self.parent.center_x
            center_y: self.parent.center_y

    Button:
        size_hint: 0.2, 1
        text: ""
        color:
        on_press: 
            # print(f'dados: ${app.root.data_items[root.id*6:(root.id*6)+6]} id:${root.id}')
            root.delete(root.id)

        Image:
            source: "Imagens/delete.png"
            center_x: self.parent.center_x
            center_y: self.parent.center_y


<TelaCli>:
    canvas.before:
        Color:
            rgba: (1,1,1,1)
        Rectangle:
            pos:self.pos
            size: self.size
    GridLayout:
        rows: 2
        GridLayout:
            cols: 2
            padding: 0
            spacing: 0
            Button:
                text: 'Cadastro'
                background_color: 0,0,0,0
                on_press: app.root.current = "telaclicadas"
                Image:
                    source: "Imagens/adicionar.png"
                    center_x: self.parent.center_x
                    center_y: self.parent.center_y
                    allow_stretch: True
            Button:
                text: 'Listar'
                background_color: 0,0,0,0
                on_press: app.root.current = "telaclilista"
                Image:
                    source: "Imagens/list-status.png"
                    center_x: self.parent.center_x
                    center_y: self.parent.center_y
                    allow_stretch: True
                
        GridLayout:
            cols: 3
            padding: 50
            spacing: 10
            Button:
                background_color: (0,0,0,0)
                background_normal: ''
            RoundedButton:
                text: 'Voltar'
                size_hint: 0.3,0.05
                on_press: app.root.current = "telag"  
            Button:
                background_color: (0,0,0,0)
                background_normal: ''      


<TelaCliCadastro>:
    nome_inserir: nome_inserir
    telefone_inserir: telefone_inserir
    email_inserir: email_inserir
    cpf_inserir: cpf_inserir
    tipo_inserir: tipo_inserir
    canvas.before:
        Color:
            rgba: (1,1,1,1)
        Rectangle:
            pos:self.pos
            size: self.size
    GridLayout:
        cols: 2
        size: root.width,root.height
        padding: 30
        spacing: 20
        Label:
            text:'Nome do Cliente'
            color: "black"
        TextInput:
            id: nome_inserir
            multiline: False
        Label:
            text:'Telefone do Cliente'
            color: "black"
        TextInput:
            id: telefone_inserir
            multiline: False
        Label:
            text:'E-mail do Cliente'
            color: "black"
        TextInput:
            id: email_inserir
            multiline: False
        Label:
            text:'CPF do Cliente'
            color: "black"
        TextInput:
            id: cpf_inserir
            multiline: False
        Label:
            text:'Tipo do Cliente'
            color: "black"
        Spinner:
            id: tipo_inserir
            text: 'Selecione'
            values:["Normal", "Vip"]    
        
        RoundedButton:
            text: "Cancelar"
            on_press: app.root.current="telacli"
        Button:
            text: "Confirmar"
            background_color: 0,0,0,0
            on_press: root.enviarBDcli()
            on_release: Factory.PopupSucesso().open()
            Image:
                source: "Imagens/check.png"
                center_x: self.parent.center_x
                center_y: self.parent.center_y
                allow_stretch: True


<TelaCliListar>:
    canvas.before:
        Color:
            rgba: (1,1,1,1)
        Rectangle:
            pos:self.pos
            size: self.size
    BoxLayout:
        orientation:'horizontal'

        BoxLayout:
            orientation:'vertical'

            GridLayout:
                size_hint: 1, None
                size_hint_y: None
                height: 25
                cols: 6
                Label:
                    text: "ID"
                    color: 'black'
                Label:
                    text: "Tipo"
                    color: 'black'
                Label:
                    text: "Nome"
                    color: 'black'
                Label:
                    text: "CPF"
                    color: 'black'
                Label:
                    text: "Telefone"
                    color: 'black'
                Label:
                    text: "Email" 
                    color: 'black'  

            BoxLayout:
                orientation: 'horizontal'
                RecycleView:
                    id: lt_cliente
                    viewclass: 'SelectableButton'
                    data: [{'text': str(x)} for x in root.data_items]
                    SelectableRecycleGridLayout:
                        cols: 6
                        default_size: None, dp(26)
                        default_size_hint: 1, None
                        size_hint_y: None
                        height: self.minimum_height
                        #orientation: 'vertical'
                        multiselect: True
                        touch_multiselect: True
        BoxLayout:
            orientation:'vertical'

            GridLayout:
                size_hint: 1, None
                size_hint_y: None
                height: 25
                cols: 2
                Label:
                    text: "Editar"
                    size_hint: .5, 1
                Label:
                    text: "Deletar"
                    size_hint: .5, 1
            RecycleView:
                id: bt_act_cliente
                viewclass: 'ButtonActions'
                data: [{'id': x } for x in range(int(len(root.data_items)/6))]
                SelectableRecycleGridLayout:
                    cols: 1
                    default_size: None, dp(26)
                    default_size_hint: 1, None
                    size_hint_y: None
                    height: self.minimum_height
                    #orientation: 'vertical'
                    multiselect: True
                    touch_multiselect: True
    RoundedButton:
        text: "Voltar"
        size_hint: 0.3, 0.3
        pos_hint: {"center_x": 0.5}
        on_press: app.root.current="telacli"



<ButtonActions>:
    # size: '100dp','100dp'
    size: 200,100
    size_hint: None, None
    Button:
        size_hint: .2, 1
        text: ""
        color:
        on_press: 
            # print(f'dados: ${app.root.data_items[root.id*6:(root.id*6)+6]} id:${root.id}')
            root.edit(root.id*6)
        Image:
            source: "Imagens/editar.png"
            center_x: self.parent.center_x
            center_y: self.parent.center_y

    Button:
        size_hint: 0.2, 1
        text: ""
        color:
        on_press: 
            # print(f'dados: ${app.root.data_items[root.id*6:(root.id*6)+6]} id:${root.id}')
            root.delete(app.root)
        Image:
            source: "Imagens/delete.png"
            center_x: self.parent.center_x
            center_y: self.parent.center_y

    


<TelaPagamento>:
    id:boleto
    canvas.before:
        Color:
            rgba: (1,1,1,1)
        Rectangle:
            pos:self.pos
            size: self.size
    
    BoxLayout:
        orientation:'vertical'
        GridLayout:
            cols:6
            Label:
                text: "ID Vaga"
                color: 'black'
            Label:
                text: "Numero da Vaga"
                color: 'black'
            Label:
                text: "Placa Carro"
                color: 'black'
            Label:
                text: "Cliente"
                color: 'black'
            Label:
                text: "Entrada"
                color: 'black'
            Label:
                text: "Saida"
                color: 'black'
        BoxLayout:
            orientation: 'horizontal'
            RecycleView:
                id: lt_pagamento
                viewclass: 'SelectableButton'
                data: [{'text': str(x)} for x in root.dt_it]
                SelectableRecycleGridLayout:
                    cols: 6
                    default_size: None, dp(26)
                    default_size_hint: 1, None
                    size_hint_y: None
                    height: self.minimum_height
                    #orientation: 'vertical'
                    multiselect: True
                    touch_multiselect: True
        BoxLayout:
            orientation:'horizontal'
            padding: 50
            spacing: 10
            Label:
                text:'Insira o ID da vaga'
                color: 'black'
            TextInput:
                id: vgtxt
                multiline: False
        GridLayout:
            cols: 5
            Button:
                background_color: (0,0,0,0)
                background_normal: ''
            RoundedButton:
                text: 'Voltar'
                size_hint: 0.3,0.05
                on_press: app.root.current = "telag" 
                    

            Button:
                background_color: (0,0,0,0)
                background_normal: ''
            Button:
                text: 'Gerar Valor'
                background_color: 0,0,0,0
                size_hint: 0.3,0.05
                on_press: root.gerar_valor(vgtxt.text, lt_pagamento)
                Image:
                    source: "Imagens/check.png"
                    center_x: self.parent.center_x
                    center_y: self.parent.center_y
                    allow_stretch: True
            Button:
                background_color: (0,0,0,0)
                background_normal: ''  
<SelectableButton>:
    canvas.before:
        Color:
            rgba: (1, 0, 0, 1) if self.selected else (0, 0, 0, 1)
        Rectangle:
            pos: self.pos
            size: self.size


        